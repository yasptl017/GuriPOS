# Punjabi Paradise - Desktop Print Agent

A Windows desktop application that polls your website server for pending print jobs
and sends them to local thermal printers automatically.

## How It Works

```
Order placed (website or POS)
    ↓
Laravel saves a print job to database (status = pending)
    ↓
This desktop app polls /api/print-agent/jobs every 3 seconds
    ↓
App sends the receipt text directly to local Windows printer
    ↓
App tells server "job printed" (status = printed)
```

---

## Building the .exe (do this once on a Windows PC with Python installed)

### Step 1 — Install Python
Download from https://www.python.org/downloads/
Make sure to check "Add Python to PATH" during install.

### Step 2 — Generate the icon (first time only)
```
pip install Pillow
python create_icon.py
```

### Step 3 — Build the exe
Double-click `build.bat`
OR run in Command Prompt:
```
build.bat
```

The output will be: `dist\PunjabiParadisePrintAgent.exe`
This single file is all you need to copy to the restaurant PC.

---

## Installing on the Restaurant PC

1. Copy `PunjabiParadisePrintAgent.exe` to the restaurant PC (e.g. Desktop)
2. Double-click it to run
3. Go to **Settings** tab and fill in:
   - **Server URL**: `https://punjabiparadise.com.au` (no trailing slash)
   - **API Key**: copy from Admin → Printer Settings page
   - **Receipt Printer**: select from dropdown (your front desk thermal printer)
   - **Kitchen Printer**: select from dropdown (kitchen thermal printer)
   - **Poll every**: 3 seconds (recommended)
   - Check **Start automatically with Windows**
4. Click **Save & Connect**
5. Status should show green "Connected"
6. Click **Test Receipt Print** and **Test Kitchen Print** to verify

---

## Finding Your Printer Names on Windows

1. Press `Win + R`, type `control printers`, press Enter
2. Your installed printers are listed
3. The name shown (e.g. "EPSON TM-T82 Receipt") is what you type in Admin → Printer Settings

**IMPORTANT:** The printer name in Admin → Printer Settings must **exactly match**
the Windows printer name. The desktop app uses that name to route jobs.

---

## Printer Settings on the Website (Admin Panel)

Go to: **Admin → Printer Settings**

- **Kitchen Printer Name**: Type the Windows printer name of the kitchen printer
- **Desk Printer Name**: Type the Windows printer name of the receipt printer

These names are stored in the database and sent with each print job so the
desktop agent knows which local printer to use.

---

## Troubleshooting

| Problem | Solution |
|---------|----------|
| "Cannot reach server" | Check Server URL is correct and internet works |
| "401 Unauthorized" | Check API Key matches what's in .env on server |
| Jobs appear but don't print | Check printer name matches exactly (case-sensitive) |
| App crashes on start | Install: `pip install pywin32 Pillow pystray` |
| Printer offline error | Check printer is on and set as default in Windows |

---

## Running Without Building (Development)

```bash
pip install -r requirements.txt
python agent.py
```

---

## Files

| File | Purpose |
|------|---------|
| `agent.py` | Main application code |
| `requirements.txt` | Python dependencies |
| `build.bat` | Builds the .exe using PyInstaller |
| `create_icon.py` | Generates icon.ico |
| `icon.ico` | App icon (generated by create_icon.py) |
